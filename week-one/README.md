# 项目性能优化

- 目标01-了解应用性能问题分析方法论

- 目标02-掌握压力测试基础概念：RT、TPS、Active Thread...

- 目标03-掌握压力测试：线程组配置、结果分析，插件使用

- 目标04-理解性能关键的指标

- 目标05-掌握压测监控平台搭建



## 性能问题分析

### 性能优化的终极目标

用户体验 = 产品设计(非技术) + 系统性能 ≈ 系统性能 = 快？

- **3S定理**：Strangeloop在对众多的网站做性能分析之后得出了一个著名的3s定律“页面加载速度超过3s，57%的访客会离开”。
- **SEO排名**：速度在Google、百度等搜索引擎的PR评分中也占有一定的比例，会影响到网站的SEO排名。

### 应用性能调优

- 后端：RT、TPS、并发数、Throughput、Footprint、Latency
  - TPS和RT的影响因素：数据库读写、RPC、网络IO、逻辑计算复杂度、JVM
- Web端：首屏时间（DNS，建立连接，后端接口返回数据相应时间，网络传输时间，首屏页面渲染页面时间）、白屏时间、可交互时间、完全加载时间...
- 移动端：端到端响应时间、Crash率、内存使用率、FPS...

### 影响性能的关键要素

- 产品设计：产品逻辑、功能交互、动态效果、页面元素
  - 举例：按钮按一次后disabled几秒，防连续点击多次无效后端请求
- 基础网络：网络 = 连接介质 + 计算终端
  - 连接介质：电缆、双绞线、光纤、微波、载波或通信卫星。
  - 计算终端：PC、手机、可穿戴设备、家具家电...
  - 基础网络设施，互联网，局域网(LAN)、城域网(MAN)、广域网(WAN)
- 代码质量&架构
  - 架构不合理
  - 研发功底和经验不足
  - 没有性能意识：只实现了业务功能不注意代码性能，新功能上线后整体性能下降，或当业务上量后系统出现连锁反应，导致性能问题叠加，直接影响用户体验。
    - 相关：阿里规约
  - 数据库：慢查询、过多查询、索引使用不当、数据库服务器瓶颈...
- 移动端环境
- 硬件及云服务



## 压力测试

**压力测试**（Stress testing）是针对特定系统或是组件，为要确认其稳定性而特意进行的严格测试。会让系统在超过正常使用条件下运作，然后再确认其结果。

压力测试是对系统不断施加压力，来预估系统服务能力的一种测试。

- 一般而言，只有在系统基础功能测试验证完成、系统趋于稳定的情况下，才会进行压测。

### 目的

1. 当负载逐渐增加时，观察**系统各项性能指标的变化情况**是否有异常

2. 发现系统的**性能短板**，进行针对性的性能优化

3. 判断系统在**高并发情况下是否会报错**，进程是否会挂掉

4. 测试在系统某个方面达到瓶颈时，粗略估计系统性能上限

### 指标

![指标1](.\note\指标1.png)

![指标2](.\note\指标2.png)

在这个图中，定义了**三条曲线、三个区域、两个点以及三个状态**描述。

- 三条曲线：
  - 吞吐量的曲线（紫色）
  - 利用率（绿色）
  - 响应时间曲线（深蓝色）

- 三个区域：
  - 轻负载区（Light Load）
  - 重负载区（Heavy Load）
  - 塌陷区（Buckle Zone）

- 两个点：
  - 最优并发用户数（The Optimum Number of Concurrent Users）
  - 最大并发用户数（The Maximum Number of Concurrent Users）

- 三个状态描述：
  - 资源饱和（Resource Saturated）
  - 吞吐下降（Throughput Falling）
  - 用户受影响（End Users Effected）

**常用压测工具：**

1. **Apache JMeter :** **可视化的测试工具**

   - Apache JMeter是Apache组织开发的基于Java的压力测试工具。用于对软件做压力测试，它最初被设计用于Web应用测试，但后来扩展到其他测试领域。 它可以用于测试**静态和动态资源**，例如静态文件、**Java** **小服务程序**、**CGI** **脚本**、**Java** **对象**、**数据库**、**FTP** **服务器**， 等等。

     官网地址：https://jmeter.apache.org/

     中文社区：http://www.jmeter.com.cn/2747.html

2. Apache的ab压力测试

3. Nginter 韩国研发

4. PAS 阿里测试工具

5. MeterSphere ：国内持续测试的开源平台

6. ...

### 目标

- 负载上升各项指标是否正常
- 发现性能短板
- 高并发下系统是否稳定
- 预估系统最大负载能力
